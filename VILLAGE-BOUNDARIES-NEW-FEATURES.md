# üöÄ ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà - ‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô

**‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà**: 21 ‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô 2025  
**‡∏ú‡∏π‡πâ‡∏û‡∏±‡∏í‡∏ô‡∏≤**: Team W  
**Version**: 1.2.0

---

## ‚úÖ ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß

### 1. üì• Export ‡πÅ‡∏ö‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô ‚úÖ

#### ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥
- ‡πÄ‡∏õ‡∏¥‡∏î Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å
- ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï
- ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏µ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏´‡∏°‡∏π‡πà‡∏û‡∏£‡πâ‡∏≠‡∏° checkbox
- ‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" ‡πÅ‡∏•‡∏∞ "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"
- ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
- ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å

#### ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
1. ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° "üì• ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å GeoJSON"
2. Modal ‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô
3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
4. ‡∏Ñ‡∏•‡∏¥‡∏Å "üì• ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å (X ‡∏´‡∏°‡∏π‡πà)"
5. ‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

#### ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
- `VillageBoundariesPage.tsx` (‡πÄ‡∏û‡∏¥‡πà‡∏° state ‡πÅ‡∏•‡∏∞ functions)
- `VillageBoundariesPage.css` (‡πÄ‡∏û‡∏¥‡πà‡∏° modal styles)

#### Code Highlights

**State Management:**
```typescript
const [showExportModal, setShowExportModal] = useState(false);
const [selectedVillagesForExport, setSelectedVillagesForExport] = useState<string[]>([]);
```

**Export Functions:**
```typescript
const handleExportGeoJSON = () => {
  // Show modal for selection
  setSelectedVillagesForExport([]);
  setShowExportModal(true);
};

const handleConfirmExport = () => {
  const villagesToExport = selectedVillagesForExport.length > 0
    ? villageBoundaries.filter(v => selectedVillagesForExport.includes(v.id) && v.boundary)
    : villageBoundaries.filter(v => v.boundary);
  
  // Create GeoJSON and download
  const featureCollection = {
    type: 'FeatureCollection',
    features: villagesToExport.map(v => ({
      type: 'Feature',
      properties: { villageNo: v.villageNo, name: v.name, id: v.id },
      geometry: v.boundary,
    })),
  };
  
  // Download file
  const filename = selectedVillagesForExport.length > 0
    ? `village-boundaries-selected-${villagesToExport.length}-${date}.geojson`
    : `village-boundaries-all-${date}.geojson`;
};
```

**Modal UI:**
```tsx
{showExportModal && (
  <div className="modal-overlay">
    <div className="modal-content export-modal">
      <div className="modal-header">
        <h2>üì• ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô</h2>
        <button className="modal-close">‚úï</button>
      </div>
      
      <div className="modal-body">
        <div className="selection-controls">
          <button onClick={selectAllVillages}>‚úÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
          <button onClick={deselectAllVillages}>‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
          <span>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß: {selectedVillagesForExport.length} ‡∏´‡∏°‡∏π‡πà</span>
        </div>
        
        <div className="villages-selection-list">
          {/* Village items with checkboxes */}
        </div>
      </div>
      
      <div className="modal-footer">
        <button onClick={() => setShowExportModal(false)}>‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button onClick={handleConfirmExport}>üì• ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å</button>
      </div>
    </div>
  </div>
)}
```

---

## üîÑ ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£

### 2. üìÅ Import GeoJSON ‡πÅ‡∏ö‡∏ö Batch (‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£)

#### ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤

**‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ:**
- ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏•‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå GeoJSON ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô
- ‡πÅ‡∏™‡∏î‡∏á preview ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á GeoJSON
- ‡πÅ‡∏™‡∏î‡∏á progress bar ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤
- ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ (‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à/‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß)
- ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≤‡∏°

**Implementation Steps:**

1. **‡πÄ‡∏û‡∏¥‡πà‡∏° State:**
```typescript
const [showImportModal, setShowImportModal] = useState(false);
const [importFiles, setImportFiles] = useState<File[]>([]);
const [importProgress, setImportProgress] = useState<{
  current: number;
  total: number;
  status: 'idle' | 'processing' | 'completed' | 'error';
}>({ current: 0, total: 0, status: 'idle' });
```

2. **File Upload Handler:**
```typescript
const handleBatchUpload = async (files: File[]) => {
  setImportFiles(files);
  setShowImportModal(true);
  
  // Validate files
  const validFiles = files.filter(f => 
    f.name.endsWith('.json') || f.name.endsWith('.geojson')
  );
  
  if (validFiles.length === 0) {
    toast.error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå GeoJSON ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
    return;
  }
  
  // Show preview
  const previews = await Promise.all(
    validFiles.map(async (file) => {
      const text = await file.text();
      const geojson = JSON.parse(text);
      return { file, geojson, valid: validateGeoJSON(geojson) };
    })
  );
  
  setImportPreviews(previews);
};
```

3. **Batch Import Function:**
```typescript
const handleConfirmBatchImport = async () => {
  setImportProgress({ current: 0, total: importFiles.length, status: 'processing' });
  
  const results = [];
  
  for (let i = 0; i < importFiles.length; i++) {
    try {
      const file = importFiles[i];
      const text = await file.text();
      const geojson = JSON.parse(text);
      
      await boundariesService.uploadGeoJSON({
        name: file.name.replace(/\.(geo)?json$/i, ''),
        type: 'custom',
        geojson: geojson,
      });
      
      results.push({ file: file.name, status: 'success' });
      setImportProgress(prev => ({ ...prev, current: i + 1 }));
    } catch (error) {
      results.push({ file: importFiles[i].name, status: 'error', error });
    }
  }
  
  setImportProgress(prev => ({ ...prev, status: 'completed' }));
  
  // Show results
  const successCount = results.filter(r => r.status === 'success').length;
  toast.success(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${successCount}/${importFiles.length} ‡πÑ‡∏ü‡∏•‡πå`);
  
  await loadBoundaries();
  setShowImportModal(false);
};
```

4. **UI Components:**
```tsx
<div className="import-modal">
  <h2>üìÅ ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ GeoJSON ‡πÅ‡∏ö‡∏ö Batch</h2>
  
  {/* File List */}
  <div className="import-files-list">
    {importFiles.map((file, index) => (
      <div key={index} className="import-file-item">
        <span>{file.name}</span>
        <span>{(file.size / 1024).toFixed(2)} KB</span>
        {importProgress.current > index && <span>‚úÖ</span>}
      </div>
    ))}
  </div>
  
  {/* Progress Bar */}
  {importProgress.status === 'processing' && (
    <div className="progress-bar">
      <div 
        className="progress-fill" 
        style={{ width: `${(importProgress.current / importProgress.total) * 100}%` }}
      />
      <span>{importProgress.current} / {importProgress.total}</span>
    </div>
  )}
  
  {/* Actions */}
  <button onClick={handleConfirmBatchImport}>
    üìÅ ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  </button>
</div>
```

---

### 3. ‚Ü©Ô∏è Undo/Redo ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏î (‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£)

#### ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤

**‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ:**
- ‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏î‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
- ‡∏õ‡∏∏‡πà‡∏° Undo ‡πÅ‡∏•‡∏∞ Redo
- Keyboard shortcuts (Ctrl+Z, Ctrl+Y)
- ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ undo ‡πÑ‡∏î‡πâ
- ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 20 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô

**Implementation Steps:**

1. **History State:**
```typescript
const [drawHistory, setDrawHistory] = useState<any[]>([]);
const [historyIndex, setHistoryIndex] = useState(-1);
const MAX_HISTORY = 20;
```

2. **Add to History:**
```typescript
const addToHistory = (geojson: any) => {
  // Remove any redo history
  const newHistory = drawHistory.slice(0, historyIndex + 1);
  
  // Add new state
  newHistory.push(geojson);
  
  // Limit history size
  if (newHistory.length > MAX_HISTORY) {
    newHistory.shift();
  }
  
  setDrawHistory(newHistory);
  setHistoryIndex(newHistory.length - 1);
};
```

3. **Undo/Redo Functions:**
```typescript
const handleUndo = () => {
  if (historyIndex > 0) {
    setHistoryIndex(historyIndex - 1);
    setDrawnBoundary(drawHistory[historyIndex - 1]);
    toast('‚Ü©Ô∏è Undo', { icon: '‚ÑπÔ∏è' });
  }
};

const handleRedo = () => {
  if (historyIndex < drawHistory.length - 1) {
    setHistoryIndex(historyIndex + 1);
    setDrawnBoundary(drawHistory[historyIndex + 1]);
    toast('‚Ü™Ô∏è Redo', { icon: '‚ÑπÔ∏è' });
  }
};
```

4. **Keyboard Shortcuts:**
```typescript
useEffect(() => {
  const handleKeyDown = (e: KeyboardEvent) => {
    if (e.ctrlKey || e.metaKey) {
      if (e.key === 'z' && !e.shiftKey) {
        e.preventDefault();
        handleUndo();
      } else if (e.key === 'y' || (e.key === 'z' && e.shiftKey)) {
        e.preventDefault();
        handleRedo();
      }
    }
  };
  
  window.addEventListener('keydown', handleKeyDown);
  return () => window.removeEventListener('keydown', handleKeyDown);
}, [historyIndex, drawHistory]);
```

5. **UI Buttons:**
```tsx
<div className="history-controls">
  <button 
    onClick={handleUndo} 
    disabled={historyIndex <= 0}
    title="Undo (Ctrl+Z)"
  >
    ‚Ü©Ô∏è Undo
  </button>
  <button 
    onClick={handleRedo} 
    disabled={historyIndex >= drawHistory.length - 1}
    title="Redo (Ctrl+Y)"
  >
    ‚Ü™Ô∏è Redo
  </button>
  <span className="history-info">
    {historyIndex + 1} / {drawHistory.length}
  </span>
</div>
```

---

### 4. üëÅÔ∏è Preview ‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£)

#### ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤

**‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ:**
- ‡πÅ‡∏™‡∏î‡∏á preview ‡∏Ç‡∏≠‡∏á‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏ó‡∏µ‡πà‡∏ß‡∏≤‡∏î
- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏£‡∏∏‡∏õ (‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà, ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏∏‡∏î, ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏Å‡∏•‡∏≤‡∏á)
- ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡πÄ‡∏î‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
- ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å, ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç, ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å

**Implementation Steps:**

1. **Preview State:**
```typescript
const [showPreview, setShowPreview] = useState(false);
const [previewData, setPreviewData] = useState<{
  boundary: any;
  name: string;
  villageNo: number | '';
  area: number;
  pointsCount: number;
  centerPoint: [number, number];
} | null>(null);
```

2. **Calculate Preview Data:**
```typescript
const calculatePreviewData = (geojson: any) => {
  const coords = geojson.geometry.coordinates[0];
  
  // Calculate area
  const area = Math.abs(coords.reduce((sum: number, coord: number[], i: number) => {
    const j = (i + 1) % coords.length;
    return sum + (coord[0] * coords[j][1] - coords[j][0] * coord[1]);
  }, 0) / 2);
  const areaKm2 = (area * 111 * 111 / 1000000).toFixed(2);
  
  // Calculate center
  let sumLat = 0, sumLng = 0;
  coords.forEach((coord: number[]) => {
    sumLng += coord[0];
    sumLat += coord[1];
  });
  const centerPoint: [number, number] = [
    sumLng / coords.length,
    sumLat / coords.length
  ];
  
  return {
    boundary: geojson,
    name: boundaryName,
    villageNo: selectedVillageNo,
    area: parseFloat(areaKm2),
    pointsCount: coords.length,
    centerPoint,
  };
};
```

3. **Show Preview:**
```typescript
const handleShowPreview = () => {
  if (!drawnBoundary) {
    toast.error('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏≤‡∏î‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏Å‡πà‡∏≠‡∏ô');
    return;
  }
  
  const preview = calculatePreviewData(drawnBoundary);
  setPreviewData(preview);
  setShowPreview(true);
};
```

4. **Preview UI:**
```tsx
{showPreview && previewData && (
  <div className="preview-modal">
    <h2>üëÅÔ∏è ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</h2>
    
    <div className="preview-info">
      <div className="info-item">
        <label>‡∏ä‡∏∑‡πà‡∏≠:</label>
        <strong>{previewData.name}</strong>
      </div>
      <div className="info-item">
        <label>‡∏´‡∏°‡∏π‡πà:</label>
        <strong>{previewData.villageNo || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</strong>
      </div>
      <div className="info-item">
        <label>‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà:</label>
        <strong>{previewData.area} ‡∏ï‡∏£.‡∏Å‡∏°.</strong>
      </div>
      <div className="info-item">
        <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏∏‡∏î:</label>
        <strong>{previewData.pointsCount} ‡∏à‡∏∏‡∏î</strong>
      </div>
      <div className="info-item">
        <label>‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏Å‡∏•‡∏≤‡∏á:</label>
        <strong>
          {previewData.centerPoint[1].toFixed(6)}, 
          {previewData.centerPoint[0].toFixed(6)}
        </strong>
      </div>
    </div>
    
    {/* Mini Map Preview */}
    <div className="preview-map">
      <VillageBoundaryMap
        existingBoundaries={[]}
        center={previewData.centerPoint}
        zoom={14}
        // Show only the drawn boundary
      />
    </div>
    
    <div className="preview-actions">
      <button onClick={() => setShowPreview(false)}>
        ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
      </button>
      <button onClick={() => {
        setShowPreview(false);
        handleSaveDrawnBoundary();
      }}>
        üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
      </button>
    </div>
  </div>
)}
```

5. **Replace Save Button:**
```tsx
{/* Replace direct save with preview */}
<button onClick={handleShowPreview}>
  üëÅÔ∏è ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
</button>
```

---

## üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤

### ‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß
1. **Export ‡πÅ‡∏ö‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô** - ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß

### üîÑ ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
2. **Import GeoJSON ‡πÅ‡∏ö‡∏ö Batch** - ‡∏°‡∏µ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß
3. **Undo/Redo ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏î** - ‡∏°‡∏µ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß
4. **Preview ‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å** - ‡∏°‡∏µ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß

---

## üöÄ ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

### Export ‡πÅ‡∏ö‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô
1. ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° "üì• ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å GeoJSON"
2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
3. ‡∏Ñ‡∏•‡∏¥‡∏Å "üì• ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å"
4. ‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î

---

## üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡πà‡∏≠

1. **Import Batch**: ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö duplicate ‡πÅ‡∏•‡∏∞ conflict resolution
2. **Undo/Redo**: ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡πá‡∏ö history ‡πÉ‡∏ô localStorage ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏±‡∏á refresh
3. **Preview**: ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡πÄ‡∏î‡∏¥‡∏° (overlay)
4. **Performance**: ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞ ‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ virtualization ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö list

---

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞**: üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤  
**Version**: 1.2.0  
**Last Updated**: 2025-11-21 08:33 UTC+7
